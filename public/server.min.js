const express=require("express"),mongoose=require("mongoose"),bodyparser=require("body-parser"),cors=require("cors"),ejs=require("ejs"),jwt=require("jsonwebtoken"),login=require("./Routes/login"),process_event=require("./tools/process_events"),user=require("./tools/user"),app=new express;mongoose.connect("mongodb://localhost/mongoose_NMS",(function(err){err||console.log("数据库连接成功")})),app.use(cors()),app.use(login),app.use(bodyparser.urlencoded({extended:!1})),app.use(express.json()),app.set("view engine","ejs"),app.use(express.static(__dirname)),console.log(__dirname),app.get("/event",(request,response)=>{process_event.find({},{del_ID:0}).sort({_id:-1}).skip().exec((err,data)=>{if(err)throw err;console.log(data),response.send(data)})}),app.post("/newEvent",(request,response)=>{const pre_event=request.body;try{process_event.create({...pre_event}).then(value=>{console.log("插入成功",value)})}catch(error){if(error)throw error}}),app.post("/user",(request,response)=>{user.find({}).exec((err,data)=>{if(err)throw err;response.send(data)})}),app.listen(8080,err=>{err||console.log("server is listening")});